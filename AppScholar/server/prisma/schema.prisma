// schema.prisma atualizado
// Adicione o relacionamento User -> Aluno

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      String   @default("USER") // ADMIN, MANAGER, USER
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ✅ NOVO: Relacionamento com Aluno
  aluno     Aluno?   @relation("UserAluno")

  @@map("User")
}

model Aluno {
  id         String   @id @default(uuid())
  nome       String
  email      String
  matricula  String   @unique
  curso      String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // ✅ NOVO: Relacionamento com User (opcional)
  userId     String?  @unique
  user       User?    @relation("UserAluno", fields: [userId], references: [id], onDelete: SetNull)

  notas      Nota[]

  @@index([userId])
  @@map("Aluno")
}

model Curso {
  id          String       @id @default(uuid())
  nome        String
  turno       String       // matutino, vespertino, noturno
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  disciplinas Disciplina[]

  @@map("Curso")
}

model Professor {
  id            String       @id @default(uuid())
  nome          String
  titulacao     String
  tempoDocencia String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  disciplinas   Disciplina[]

  @@map("Professor")
}

model Disciplina {
  id           String     @id @default(uuid())
  nome         String
  cargaHoraria Int
  cursoId      String?
  professorId  String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  
  curso        Curso?     @relation(fields: [cursoId], references: [id], onDelete: SetNull)
  professor    Professor? @relation(fields: [professorId], references: [id], onDelete: SetNull)
  notas        Nota[]

  @@index([cursoId])
  @@index([professorId])
  @@map("Disciplina")
}

model Nota {
  id           String     @id @default(uuid())
  disciplinaId String
  alunoId      String?    // se null = nota global (sem aluno específico)
  n1           Float      @default(0)
  n2           Float      @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  disciplina   Disciplina @relation(fields: [disciplinaId], references: [id], onDelete: Cascade)
  aluno        Aluno?     @relation(fields: [alunoId], references: [id], onDelete: Cascade)

  @@unique([disciplinaId, alunoId])
  @@index([alunoId])
  @@map("Nota")
}
